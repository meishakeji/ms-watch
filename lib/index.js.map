{"version":3,"file":"index.js","mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;;;;;;;;;;ACTA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,mBAAmB,mBAAmB;AACtC,IAAI;AACJ,wBAAwB,KAAK;AAC7B,IAAI;AACJ,8BAA8B,KAAK;AACnC,IAAI;AACJ,mBAAmB,KAAK;AACxB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC3FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,cAAc,KAAK,KAAK,UAAU;AAClC,uBAAuB,UAAU,cAAc,6BAA6B;AAC5E,uBAAuB,UAAU,cAAc,6BAA6B;AAC5E;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;;;;;;;;;ACzFA;AACA;AACA;AACA,yEAAyE;AACzE;AACA,2EAA2E;AAC3E;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sCAAsC;AACtC,YAAY,+BAA+B;;AAE3C;AACA;AACA;AACA,QAAQ;AACR;AACA,QAAQ;AACR;AACA,QAAQ;AACR;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,YAAY,mDAAmD;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;AC5JA,QAAQ,OAAO,EAAE,mBAAO,CAAC,kCAAY;;AAErC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA,MAAM;AACN;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;;AAEA;AACA;AACA;;;;;;;;;;;AC1LA;;AAEA,QAAQ,WAAW,EAAE,mBAAO,CAAC,oCAAa;AAC1C,QAAQ,WAAW,EAAE,mBAAO,CAAC,oCAAa;AAC1C,QAAQ,YAAY,EAAE,mBAAO,CAAC,sCAAc;AAC5C,QAAQ,qCAAqC,EAAE,mBAAO,CAAC,oCAAa;AACpE,QAAQ,UAAU,EAAE,mBAAO,CAAC,kCAAY;AACxC,QAAQ,eAAe,EAAE,mBAAO,CAAC,wCAAe;AAChD,QAAQ,aAAa,EAAE,mBAAO,CAAC,wCAAe;AAC9C,QAAQ,YAAY,EAAE,mBAAO,CAAC,sCAAc;AAC5C,QAAQ,OAAO,EAAE,mBAAO,CAAC,kCAAY;;;AAGrC;AACA;AACA,YAAY,2BAA2B;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,eAAe,aAAa;AAC5B,sBAAsB,YAAY;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2DAA2D;AAC3D,OAAO;AACP,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,kCAAkC;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,MAAM;AACN;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,MAAM;AACN;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;;;;;;;;;;ACxMA;AACA,gBAAgB,sBAAsB;AACtC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,oDAAoD;AACpD,SAAS;AACT;AACA;AACA,QAAQ;AACR;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;;;;;;;;;;;AChDA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,iCAAiC,IAAI,GAAG,YAAY;AACpD;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;;;;;;;;;;ACzBA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA,gBAAgB,gCAAgC;AAChD;AACA,UAAU;AACV,eAAe,+BAA+B;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;;;;;;;;;ACvHA,QAAQ,YAAY,EAAE,mBAAO,CAAC,sCAAc;AAC5C,QAAQ,OAAO,EAAE,mBAAO,CAAC,kCAAY;;AAErC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;;;;;;;;;;ACrGA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;UCxBA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;UEtBA;UACA;UACA;UACA","sources":["webpack://meisha_watch/webpack/universalModuleDefinition","webpack://meisha_watch/./src/config.js","webpack://meisha_watch/./src/console.js","webpack://meisha_watch/./src/device.js","webpack://meisha_watch/./src/error.js","webpack://meisha_watch/./src/index.js","webpack://meisha_watch/./src/postData.js","webpack://meisha_watch/./src/storage.js","webpack://meisha_watch/./src/timing.js","webpack://meisha_watch/./src/userInfo.js","webpack://meisha_watch/./src/utils.js","webpack://meisha_watch/webpack/bootstrap","webpack://meisha_watch/webpack/before-startup","webpack://meisha_watch/webpack/startup","webpack://meisha_watch/webpack/after-startup"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"meisha_watch\"] = factory();\n\telse\n\t\troot[\"meisha_watch\"] = factory();\n})(self, function() {\nreturn ","\nconst HOST = \"test-monitor.meishakeji.com\";\n\nconst ENV = {\n  LOCAL: /^(127.0.0.1|localhost|192.168)/.test(window.location.host),\n  DEV: /^(127.0.0.1|localhost|192.168|nathan-|dev-|hank-|kerry-|39.108.58.1)/.test(\n    window.location.host\n  ),\n  TEST: /^test-/.test(window.location.host),\n  PRE: /^pre-/.test(window.location.host),\n};\n\nconst getBaseUrl = () => {\n  let baseUrl = \"\";\n\n  if (ENV.DEV) {\n    baseUrl = `//${DEVELOP_LOCAL_HOST}`;\n  } else if (ENV.TEST) {\n    baseUrl = `//test-${HOST}`;\n  } else if (ENV.PRE) {\n    baseUrl = HOST ? `//pre-${HOST}` : \"\";\n  } else {\n    baseUrl = `//${HOST}`;\n  }\n  return baseUrl;\n};\n\nconst TimeLog = [\n  {\n    key: \"redirectTime\",\n    value: \"重定向耗时\",\n  },\n  {\n    key: \"dnsTime\",\n    value: \"DNS解析耗时\",\n  },\n  {\n    key: \"connectTime\",\n    value: \"TCP连接耗时\",\n  },\n  {\n    key: \"requestTime\",\n    value: \"HTTP请求耗时\",\n  },\n  {\n    key: \"firstByteTime\",\n    value: \"首字节耗时\",\n  },\n  {\n    key: \"domReadyTime\",\n    value: \"解析dom树耗时\",\n  },\n  {\n    key: \"whiteTime\",\n    value: \"白屏时间\",\n  },\n  {\n    key: \"domLoadTime\",\n    value: \"DOMready时间\",\n  },\n  {\n    key: \"jsEventTime\",\n    value: \"脚本加载时间\",\n  },\n  {\n    key: \"fpTime\",\n    value: \"FP首屏时间\",\n  },\n  {\n    key: \"fcpTime\",\n    value: \"FCP首次绘制时间\",\n  },\n  {\n    key: \"ttiTime\",\n    value: \"首次可交互时间\",\n  },\n  {\n    key: \"loadTime\",\n    value: \"页面加载完成的时间\",\n  },\n];\n\n// 上报间隔时间\nconst reportSplitTime = 1000 * 60 * 3;\n// 错误超过6条上报\nconst errorNum = 6;\n\nmodule.exports = {\n  getBaseUrl,\n  TimeLog,\n  reportSplitTime,\n  errorNum,\n};","\nclass MSConsole {\n  constructor() {\n    this.console = window.console;\n    this.infoList = [];\n    this.infoFns = [];\n    this.warnList = [];\n    this.warnFns = [];\n    this.errorList = [];\n    this.errorFns = [];\n  }\n\n  log(obj, color1 = \"#35495e\", color2 = \"#41b883\") {\n    for (let key in obj) {\n      console.log(\n        `%c ${key} %c ${obj[key]} `,\n        `background: ${color1} ; padding: 1px; border-radius: 3px 0 0 3px;  color: #fff`,\n        `background: ${color2} ; padding: 1px; border-radius: 0 3px 3px 0;  color: #fff`\n      );\n    }\n  }\n\n  info(callback) {\n    const info = this.console.info;\n    if (typeof callback === \"function\") {\n      this.infoFns.push(callback);\n    }\n    window.console.info = (...arg) => {\n      this.infoList.push({\n        arg,\n        url: window.location.href,\n      });\n      for (let fn of this.infoFns) {\n        fn(...arg);\n      }\n      info(...arg);\n    };\n  }\n\n  warn(callback) {\n    const warn = this.console.warn;\n    if (typeof callback === \"function\") {\n      this.warnFns.push(callback);\n    }\n    window.console.warn = (...arg) => {\n      this.warnList.push({\n        arg,\n        url: window.location.href,\n        createTime: Math.floor(Date.now() / 1000),\n      });\n      for (let fn of this.warnFns) {\n        fn(...arg);\n      }\n      warn(...arg);\n    };\n  }\n\n  error(callback) {\n    const error = this.console.error;\n    if (typeof callback === \"function\") {\n      this.errorFns.push(callback);\n    }\n    window.console.error = (...arg) => {\n      this.errorList.push({\n        arg,\n        url: window.location.href,\n        createTime: Math.floor(Date.now() / 1000),\n      });\n      for (let fn of this.errorFns) {\n        fn(...arg);\n      }\n      error(...arg);\n    };\n  }\n\n  getInfo() {\n    return {\n      warnList: this.warnList,\n      errorList: this.errorList,\n    };\n  }\n\n  clearInfo() {\n    this.errorList = [];\n    this.warnList = [];\n  }\n}\n\nmodule.exports = {\n  MSConsole,\n};","\nclass MSDevice {\n  constructor(performance) {\n    this.width =\n      document.documentElement.clientWidth || document.body.clientWidth; //浏览器宽度\n    this.height =\n      document.documentElement.clientHeight || document.body.clientHeight; //浏览器高度\n    this.userAgent =\n      (\"navigator\" in window &&\n        \"userAgent\" in navigator &&\n        navigator.userAgent.toLowerCase()) || \"\";\n    const p =\n      window.performance || window.msPerformance || window.webkitPerformance;\n\n    this.performance = performance || p;\n    this.osVersion = this.getOS();\n    this.browerVersion = this.getExplore();\n    this.network = this.getNetWork();\n    \n    this.createTime = Date.now();\n    this.memory = this.getMemory();\n  }\n\n  getOS() {\n    var userAgent = this.userAgent;\n    var vendor =\n      (\"navigator\" in window &&\n        \"vendor\" in navigator &&\n        navigator.vendor.toLowerCase()) ||\n      \"\";\n    var appVersion =\n      (\"navigator\" in window &&\n        \"appVersion\" in navigator &&\n        navigator.appVersion.toLowerCase()) ||\n      \"\";\n\n    if (/mac/i.test(appVersion)) {\n      return \"MacOSX\";\n    }\n    if (/win/i.test(appVersion)) {\n      return \"windows\";\n    }\n    if (/linux/i.test(appVersion)) {\n      return \"linux\";\n    }\n    if (/iphone/i.test(userAgent) || /ipod/i.test(userAgent)) {\n      return \"ios\";\n    }\n    if (/ipad/i.test(userAgent)) {\n      return \"ipad\";\n    }\n    if (/android/i.test(userAgent)) {\n      return \"android\";\n    }\n    if (/win/i.test(appVersion) && /phone/i.test(userAgent)) {\n      return \"windowsPhone\";\n    }\n  }\n\n  getExplore() {\n    var sys = {},\n      ua = navigator.userAgent.toLowerCase(),\n      s;\n    (s = ua.match(/rv:([\\d.]+)\\) like gecko/))\n      ? (sys.ie = s[1])\n      : (s = ua.match(/msie ([\\d\\.]+)/))\n      ? (sys.ie = s[1])\n      : (s = ua.match(/edge\\/([\\d\\.]+)/))\n      ? (sys.edge = s[1])\n      : (s = ua.match(/firefox\\/([\\d\\.]+)/))\n      ? (sys.firefox = s[1])\n      : (s = ua.match(/(?:opera|opr).([\\d\\.]+)/))\n      ? (sys.opera = s[1])\n      : (s = ua.match(/micromessenger\\/([\\d\\.]+)/i))\n      ? (sys.weixin = s[1])\n      : (s = ua.match(/chrome\\/([\\d\\.]+)/))\n      ? (sys.chrome = s[1])\n      : (s = ua.match(/version\\/([\\d\\.]+).*safari/))\n      ? (sys.safari = s[1])\n      : (s = ua.match(/weibo\\/([\\d\\.]+)/i))\n      ? (sys.weibo = s[1])\n      : 0;\n    // 根据关系进行判断\n    if (sys.ie) return \"IE: \" + sys.ie;\n    if (sys.edge) return \"EDGE: \" + sys.edge;\n    if (sys.firefox) return \"Firefox: \" + sys.firefox;\n    if (sys.weixin) return \"weixin: \" + sys.weixin;\n    if (sys.chrome) return \"Chrome: \" + sys.chrome;\n    if (sys.opera) return \"Opera: \" + sys.opera;\n    if (sys.safari) return \"Safari: \" + sys.safari;\n    if (sys.weibo) return \"weibo: \" + sys.weibo;\n    return \"Unkonwn\";\n  }\n\n  getNetWork() {\n    var connection = navigator.connection ||\n      navigator.mozConnection ||\n      navigator.webkitConnection || { tyep: \"unknown\" };\n    const { effectiveType, downlink, rtt } = connection;\n\n    if (typeof downlink == \"number\") {\n      if (downlink >= 10) {\n        connection.type = \"wifi\";\n      } else if (downlink > 2) {\n        connection.type = \"3g\";\n      } else if (downlink > 0) {\n        connection.type = \"2g\";\n      } else if (downlink == 0) {\n        connection.type = \"none\";\n      } else {\n        connection.type = \"unknown\";\n      }\n    }\n    return {\n      type: effectiveType || connection.type,\n      downlink: downlink,\n      rtt: rtt,\n      isOnline: navigator.onLine,\n    };\n  }\n\n  computedSize(value) {\n    return value / 1024 / 1024;\n  }\n\n  getMemory() {\n    const { usedJSHeapSize, totalJSHeapSize, jsHeapSizeLimit } =\n      this.performance.memory;\n    \n    return {\n      usedSize: this.computedSize(usedJSHeapSize).toFixed(2) + ' MB',\n      totalSize: this.computedSize(totalJSHeapSize).toFixed(2) + ' MB',\n      limitSize: this.computedSize(jsHeapSizeLimit).toFixed(2) + ' MB',\n      // usedJSHeapSize,\n      // totalJSHeapSize,\n      // jsHeapSizeLimit,\n    };\n  }\n\n  getInfo() {\n\n    return {\n      width: this.width,\n      height: this.height,\n      userAgent: this.userAgent,\n      osVersion: this.osVersion,\n      browerVersion: this.browerVersion,\n      network: this.network,\n      // createTime: this.createTime,\n      memory: this.memory,\n      // url: window.location.href,\n    };\n  }\n}\nmodule.exports = {\n  MSDevice,\n};","const { guid } = require('./utils.js');\n\nconst ErrorType = {\n  SyntaxError: \"语法错误\",\n  TypeError: \"类型错误\",\n  ReferenceError: \"声明错误\",\n  RangeError: \"栈溢出错误\",\n  ResourceError: \"资源加载错误\",\n  HttpError: \"http请求错误\",\n};\n\nclass MSError {\n  constructor() {\n    this.errorList = [];\n  }\n  // type 为 error 捕获语法等js错误\n  // type 为 unhandledrejection 捕获 promise 错误\n  recordError(callback) {\n    this.handleAddListener(\"error\", (e) => {\n      const result = this.getError(e);\n      this.errorList.push(result);\n      if(callback && typeof callback === 'function') {\n        callback();\n      }\n    });\n    this.handleAddListener(\"unhandledrejection\", (e) => {\n      const result = this.getError(e);\n      this.errorList.push(result);\n      if(callback && typeof callback === 'function') {\n        callback();\n      }\n    });\n    this.handlerError((message, source, lineno, colno, error) => {\n      const e = {\n        type: 'runError',\n        message,\n        source,\n        lineno,\n        colno,\n        ...error\n      }\n      const result = this.getError(e);\n      this.errorList.push(result);\n      if(callback && typeof callback === 'function') {\n        callback();\n      }\n    });\n  }\n  // TypeError: 类型错误\n  getSyntaxError(e) {\n    const error = e.error;\n    const errorType = error.stack.split(\":\")[0];\n    const errorText = ErrorType[errorType];\n    let target = \"\";\n    if (e.target === window) {\n      target = \"window\";\n    } else if (e.target === document) {\n      target = \"document\";\n    } else {\n      target = e.target && e.target.nodeName || '';\n    }\n    let obj = {\n      errorText,\n      errorType,\n      type: e.type,\n      message: error.message,\n      stack: error.stack,\n      nodeName: target,\n    };\n    if(error.colno) {\n      Object.assign(obj, {\n        colno: error.colno,\n      })\n    }\n    if(error.lineno) {\n      Object.assign(obj, {\n        lineno: error.lineno,\n      })\n    }\n    return obj;\n  }\n  // promise 错误\n  getPromiseError(e) {\n    const reason = e.reason;\n    const errorType = reason.stack.split(\":\")[0];\n    const errorText = ErrorType[errorType] || '未定义错误';\n    let obj = {\n      errorText,\n      errorType,\n      type: e.type,\n      message: reason.message,\n      stack: reason.stack,\n      nodeName: 'window',\n    };\n    return obj;\n  }\n  // ResourceError: 资源加载错误\n  getResourceError(e) {\n    let obj = {};\n    const target = e.target;\n    const nodeNames = [\"img\", \"script\", \"link\"];\n    const name = target.nodeName.toLocaleLowerCase();\n    if (nodeNames.includes(name)) {\n      console.log('target', target);\n      obj = {\n        nodeName: target.nodeName,\n        errorText: \"资源加载错误\",\n        errorType: \"ResourceError\",\n        src: target.src || target.href,\n        className: target.className,\n        outerHTML: target.outerHTML,\n        type: e.type,\n      };\n      if(name === 'img') {\n        Object.assign(obj, {\n          top: target.x,\n          left: target.y,\n          width: target.width,\n          height: target.height,\n        })\n      }\n    }\n    return obj;\n  }\n  // 运行的错误\n  getRunError(e) {\n    const errorType = e.message && e.message.split(':')[0] && e.message.split(':')[0].split(' ')[1];\n    const errorText = ErrorType[errorType];\n    return {\n      nodeName: 'window',\n      errorText,\n      errorType,\n      type: 'runError',\n      message: e.message,\n      source: e.source,\n      lineno: e.lineno,\n      colno: e.colno,\n      stack: e.stack,\n    }\n  }\n\n  getError(e) {\n    const error = e.error;\n    const reason = e.reason;\n    let obj = {};\n    if (e.target && e.target.nodeName) {\n      obj = this.getResourceError(e);\n    } else if (error) {\n      obj = this.getSyntaxError(e);\n    } else if (reason) {\n      obj = this.getPromiseError(e);\n    } else if(e.type === 'runError') {\n      obj = this.getRunError(e);\n    }\n    Object.assign(obj, {\n      createTime: Math.floor(Date.now() / 1000),\n      id: guid(24),\n      url: window.location.href,\n    })\n    return obj;\n  }\n  // 图片、script、css加载错误\n  handleAddListener(type, fn) {\n    if (window.addEventListener) {\n      window.addEventListener(type, fn, true);\n    } else {\n      window.attachEvent(\"on\" + type, fn);\n    }\n  }\n  handlerError(fn) {\n    window.onerror = fn;\n  }\n\n  clearInfo() {\n    this.errorList = [];\n  }\n  // vue 错误处理\n  // Vue.config.errorHandler = function (err) {\n  //   setTimeout(() => {\n  //     throw err\n  //   })\n  // }\n}\n\nmodule.exports = {\n  MSError,\n};\n","// 用户信息|内存信息| 导航信息|网络质量|用户操作路径｜javascript 异常信息 ｜ js执行时间 ｜ user-agent｜报文生成时间 \n\nconst { MSTiming } = require(\"./timing.js\");\nconst { MSDevice } = require(\"./device.js\");\nconst { MSConsole } = require(\"./console.js\");\nconst { TimeLog, reportSplitTime, errorNum } = require(\"./config.js\");\nconst { MSError } = require(\"./error.js\");\nconst { MSUserAction } = require(\"./userInfo.js\");\nconst { MSSendData } = require(\"./postData.js\");\nconst { MSStorage } = require(\"./storage.js\");  \nconst { guid } = require('./utils.js');\n\n\nclass MSMain {\n  constructor(data) {\n    const { projectName, url, router } = data || {};\n    this.error = new MSError();\n    // this.error.recordError(this.errorReport.bind(this));\n    this.listenLoad();\n    this.listenUnload();\n    this.listenVisible();\n    this.timing = null;\n    this.device = null;\n    this.mconsole = null;\n    this.action = null;\n    this.storage = null;\n    this.useInfo = null;\n    this.timeId = guid()\n    if(!projectName) {\n      throw new Error('projectName 不能为空');\n    }\n    if(!url) {\n      throw new Error('URL 不能为空');\n    }\n    if(!router) {\n      throw new Error('请传入router实例')\n    }\n    this.projectName = projectName;\n    this.url = url;\n    this.router = router;\n    this.firstEnter = true;\n  }\n\n  async init() {\n    const performance =\n      window.performance || window.msPerformance || window.webkitPerformance;\n\n    this.timing = new MSTiming(performance);\n    this.device = new MSDevice();\n    this.mconsole = new MSConsole();\n    this.action = new MSUserAction(this.router);\n    this.storage = new MSStorage(this.action.userInfo);\n    this.useInfo = this.action.userInfo;\n\n    const timing = await this.timing.getTime();\n    let obj = {};\n    for (let { key, value } of TimeLog) {\n      obj[value] = `${timing[key]}ms`;\n    }\n    this.mconsole.log(obj);\n    this.action.listenRouter();\n    this.action.listenAction();\n    this.mconsole.warn();\n    this.mconsole.error();\n    this.msend = new MSSendData({\n      url: this.url,\n      method: 'post',\n      headers: {\n        'content-Type': 'application/x-www-form-urlencoded;'\n      },\n    });\n    this.report()\n  }\n\n  getData() {\n    const timing = this.timing.getTime();\n    const device = this.device.getInfo();\n    const consoleInfo = this.mconsole.getInfo();\n    const action = this.action.getInfo();\n    delete action.userInfo;\n    const { userId, name, realname, phoneNo } = this.useInfo;\n    return {\n      project: this.projectName,\n      requestId: guid(0, 24, false),\n      httpHost: window.location.host,\n      requestUri: window.location.href,\n      user: {\n        userId,\n        name: name || realname,\n        phoneNo,\n      },\n      timing: this.firstEnter ? timing : null,\n      device: this.firstEnter ? device : null,\n      logs: [\n        {\n          \"console\": consoleInfo,\n          \"action\": action,\n        }\n      ]\n    };\n  }\n  clearData() {\n    this.timing.clearInfo();\n    this.device.clearInfo();\n    this.mconsole.clearInfo();\n    this.action.clearInfo();\n    this.firstEnter = false;\n  }\n  listenLoad() {\n    this.error.handleAddListener(\"load\", () => {\n      setTimeout(async () => {\n        this.init();\n      }, 200)\n    });\n  }\n  listenUnload() {\n    let that = this;\n    this.error.handleAddListener(\"unload\", () => {\n      that.saveLog();\n    });\n  }\n\n  listenVisible() {\n    let that = this;\n    this.error.handleAddListener(\"visibilitychange\", (e) => {\n      const state = document.visibilityState === 'visible';\n      if(state) {\n        that.saveLog();\n      }\n    });\n  }\n\n  saveLog() {\n    const errList = this.storage.get('MsError') || [];\n    const res = this.getData();\n    errList.push(res);\n    this.storage.set('MsError', errList);\n\n    return errList;\n  }\n\n  clearLog() {\n    this.storage.set('MsError', []);\n  }\n\n  report() {\n    const errList = this.saveLog();\n    console.log('errList', errList);\n    console.log(JSON.stringify(errList, null, 4));\n    if(errList.length > 0) {\n      \n      const len = errList.length - 1;\n      if (Date.now() - errList[len].createTime > reportSplitTime) {\n        console.log('report len > 0', errList);\n        this.msend.xhrReport({\n          data: errList\n        })\n        this.clearData();\n      }\n    } else {\n      console.log('report len < 0', errList);\n      this.msend.xhrReport({\n        data: errList\n      })\n      this.clearData();\n    }\n  }\n\n  errorReport() {\n    const errorList = this.error.errorList\n    const errList = this.saveLog();\n    \n    if(errList.length > 0) {\n      const len = errList.length - 1;\n      const bool1 = Date.now() - errList[len].createTime > reportSplitTime;\n      const bool2 = errorList.length > errorNum;\n      if (bool1 && bool2) {\n        console.log('errorReport len > 0', errList);\n        this.msend.xhrReport({\n          data: errList\n        })\n        this.clearData();\n      }\n    } else {\n      console.log('errorReport len < 0', errList);\n      this.msend.xhrReport({\n        data: errList\n      })\n      this.clearData();\n    }\n  }\n}\n// const m = new MSMain({\n//   projectName: 1,\n//   url: 'http://localhost:3000/test',\n//   router: {}\n// })\n// window.ms = m;\nmodule.exports = {\n  MSMain\n};","class MSSendData {\n  constructor({ url, headers, method }) {\n    this.url = url;\n    this.headers = headers;\n    this.method = method;\n  }\n\n  xhrReport(data) {\n    return new Promise((resolve, reject) => {\n      const xhr = new XMLHttpRequest();\n      xhr.open(this.method, this.url, false);\n      // xhr.withCredentials = true;\n      Object.keys(this.headers).forEach((key) => {\n        xhr.setRequestHeader(key, this.headers[key]);\n      });\n      xhr.onreadystatechange = () => {\n        if(+xhr.readyState === 4 && +xhr.status === 200) {\n          resolve(xhr.responseText)\n        }\n      }\n\n      xhr.onerror = (err) => {\n        reject(err)\n      }\n      xhr.ontimeout = (err) => {\n        reject(err)\n      }\n\n      xhr.send(JSON.stringify(data));\n    })\n  }\n\n  sendBeacon(data) {\n    return new Promise((resolve, reject) => {\n      try {\n        const blob = new Blob([JSON.stringify(data)], { \n          type: 'application/x-www-form-urlencoded; charset=UTF-8'\n        });\n        navigator.sendBeacon(this.url, blob);\n        resolve(this.data);\n      } catch (error) {\n        reject(error);\n      }\n    })\n  }\n}\n\nmodule.exports = {\n  MSSendData,\n};","\nclass MSStorage {\n  constructor(userInfo) {\n    this.localStorage = window.localStorage;\n  }\n\n  get(key) {\n    const result = this.localStorage.getItem(key);\n    if (result) {\n      return JSON.parse(result);\n    }\n    return false;\n  }\n\n  set(key, value) {\n    this.localStorage.setItem(`${key}-${this.userId}`, JSON.stringify(value));\n  }\n\n  remove(key) {\n    this.localStorage.removeItem(key);\n  }\n\n}\n\nmodule.exports = {\n  MSStorage,\n};","\n// const ttiPolyfill = require('tti-polyfill');\n\nclass MSTiming {\n  constructor(performance) {\n    const p =\n      window.performance ||\n      window.msPerformance ||\n      window.webkitPerformance;\n\n    this.performance = performance || p;\n    this.timing = performance.timing\n  }\n\n  getTime() {\n    var t = this.timing;\n    var obj = {\n      // timing: this.timing\n    };\n    // 重定向次数\n    obj.redirectCount = this.performance.navigation.redirectCount;\n    // 重定向耗时\n    obj.redirectTime = t.redirectEnd - t.redirectStart\n    // DNS解析，DNS查询耗时\n    obj.dnsTime = t.domainLookupEnd - t.domainLookupStart;\n    // TCP链接耗时\n    obj.connectTime = t.connectEnd - t.connectStart;\n    // HTTP请求耗时\n    obj.requestTime = t.responseEnd - t.requestStart;\n    // 获得首字节耗费时间，也叫TTFB\n    obj.firstByteTime = t.responseStart - t.navigationStart;\n    // 解析dom树耗时\n    obj.domReadyTime = t.domComplete - t.responseEnd;\n    // 白屏时间耗时\n    obj.whiteTime = t.responseStart - t.navigationStart;\n    // DOMready时间\n    obj.domLoadTime = t.domContentLoadedEventEnd - t.navigationStart;\n    // 脚本加载时间\n    obj.jsEventTime = t.domContentLoadedEventEnd - t.domContentLoadedEventStart\n    // 页面加载完成的时间 即：onload时间\n    obj.loadTime = t.loadEventEnd - t.navigationStart;\n    // 首屏时间\n    obj.paintTime = t.domComplete - t.navigationStart;\n    // 首次可交互时间\n    obj.ttiTime = t.domInteractive - t.navigationStart;\n    // FP首屏时间   FCP首次绘制时间  首次可交互时间  用户首次交互时间  \n    const res = this.getFPTime();\n    // const res = await this.getFirstPaintTime()\n    // obj.userKeyTime = {\n    //   fmpTime: obj.paintTime,\n    //   ...res,\n    // }\n    return {\n      ...obj,\n      ...res,\n      // url: window.location.href,\n    }\n  }\n\n  getFPTime() {\n    const performance = this.performance;\n    let obj = {\n      fpTime: -1,\n      fcpTime: -1,\n    };\n    if (typeof performance.getEntriesByType === 'function') {\n      const fpList = this.performance.getEntriesByName('first-paint');\n      const fcpList = this.performance.getEntriesByName('first-contentful-paint');\n      console.log('fpList', fpList, fcpList);\n      let fp = fpList && fpList[0].duration\n      let fcp = fcpList && fcpList[0].duration\n      obj = {\n        fpTime: fp,\n        fcpTime: fcp,\n      }\n    }\n    return obj;\n  }\n\n  async getFirstPaintTime() {\n    const performance = this.performance\n    let obj = {}\n    try {\n      if (typeof performance.getEntriesByType === 'function') {\n        const fpList = this.performance.getEntriesByName('first-paint');\n        const fcpList = this.performance.getEntriesByName('first-contentful-paint');\n        console.log('fpList', fpList, fcpList);\n        let fp = fpList && fpList[0].duration\n        let fcp = fcpList && fcpList[0].duration\n        obj = {\n          fpTime: fp,\n          fcpTime: fcp,\n        }\n      } else {\n        let fp = -1\n        if (chrome && chrome.loadTimes) {\n          let loadTimes = window.chrome.loadTimes();\n          let { firstPaintTime, startLoadTime } = loadTimes;\n          fp = (firstPaintTime - startLoadTime) * 1000;\n        } else if (performance.timing && typeof performance.timing.msFirstPaint === 'number') {\n          let {msFirstPaint, navigationStart} = performance.timing;\n          fp = msFirstPaint - navigationStart;\n        }\n        obj = {\n          fpTime: fp,\n          fcpTime: -1,\n        }\n      }\n      const tti = await ttiPolyfill.getFirstConsistentlyInteractive()\n      obj['tti'] = tti\n      return obj\n    } catch (error) {\n      console.warn(error)\n      return obj\n    }\n  }\n}\n\nmodule.exports = {\n  MSTiming,\n};","\nconst { MSStorage } = require(\"./storage.js\");\nconst { guid } = require(\"./utils.js\");\n\nclass MSUserInfo {\n  constructor() {\n    this.mstorage = new MSStorage();\n    this.userInfo = this.mstorage.get('userInfo');\n    this.userId = this.userInfo && this.userInfo.userId;\n  }\n  // 各系统用户信息需要存储在localStorage中的 userInfo 字段\n  getUserInfo() {\n    return this.userInfo || {};\n  }\n\n}\n\nclass MSUserAction {\n  constructor(router) {\n    if(!router) {\n      throw new Error('请传入router实例')\n    }\n    this.userInfo = new MSUserInfo();\n    this.router = router;\n    this.routeList = [];\n    this.clickList = [];\n    this.content = '';\n  }\n\n  listenRouter(callback) {\n    this.router.beforeEach && this.router.beforeEach((to, from, next) => {\n      const obj = {\n        to: {\n          fullPath: to.fullPath,\n          name: to.name,\n          params: to.params,\n          path: to.path,\n          query: to.query\n        },\n        from: {\n          fullPath: from.fullPath,\n          name: from.name,\n          params: from.params,\n          path: from.path,\n          query: from.query\n        },\n        createTime: Math.floor(Date.now() / 1000),\n        id: guid(24),\n        url: window.location.href,\n      };\n      this.routeList.push(obj);\n      if(callback && typeof callback === 'function') {\n        callback(to, from);\n      }\n      next();\n    });\n  }\n\n  listenAction() {\n    this.listenClick();\n  }\n\n  handleAddListener(type, fn) {\n    if (window.addEventListener) {\n      window.addEventListener(type, fn, true);\n    } else {\n      window.attachEvent(\"on\" + type, fn);\n    }\n  }\n\n  listenClick() {\n    this.handleAddListener('click', (e) => {\n      const target = e.target;\n      const innerText = target.innerText;\n      this.clickList.push({\n        innerText,\n        left: e.clientX || e.x || e.offsetX || e.pageX,\n        top: e.clientY || e.y || e.offsetY || e.pageY,\n        createTime: Math.floor(Date.now() / 1000),\n        id: guid(24),\n        url: window.location.href,\n      })\n    })\n  }\n\n  getInfo() {\n    return {\n      userInfo: this.userInfo.userInfo,\n      clickList: this.clickList,\n      routeList: this.routeList,\n    }\n  }\n\n  clearInfo() {\n    this.clickList = [];\n    this.routeList = [];\n  }\n}\n\n\nmodule.exports = {\n  MSUserAction,\n  MSUserInfo,\n};","\n\nconst guid = (start, end, isSlice = true) => {\n  const result = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    var r = Math.random() * 16 | 0,\n      v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n  return isSlice ? result.slice(start, end) : result;\n}\n\nconst tryError = (callback) => {\n  if(callback && typeof callback === 'function') {\n    try {\n      callback();\n    } catch (err) {\n      console.error(err);\n    }\n  }\n}\n\nmodule.exports = {\n  guid,\n  tryError,\n};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(\"./src/index.js\");\n",""],"names":[],"sourceRoot":""}